# 中间件（Middleware）

## 消息中间件

### 应用场合

- 异步（高并发）
- 解耦
- 削峰（秒杀，双11）

### 常见产品

- RocketMQ：阿里，Apache，集群方便，适合超大数据量
- RabbitMQ：金融，Erlang，消息积压性能下滑明显，集群配置复杂
- Kafka：LinkedIn，日志，Scala
- ActiveMQ：Apache
- ZeroMQ：bitcoind

RabbitMQ, Kafka, RocketMQ 对比

- Kafka: 无限消息堆积，高效的持久化速度, 主要定位于日志传输。Kafka主要特点是基于Pull的模式来处理消息消费，追求高吞吐量，一开始的目的就是用于日志收集和传输。0.8版本开始支持复制，不支持事务，对消息的重复、丢失、错误没有严格要求，适合产生大量数据的互联网服务的数据收集业务。
- RocketMQ: 定位于非日志的可靠消息传输（日志场景也OK）, 使用场景：订单，交易，充值，流计算，消息推送，日志流式处理，binlog分发
- RabbitMQ是使用Erlang语言开发的开源消息队列系统，基于AMQP协议来实现。AMQP的主要特征是面向消息、队列、路由（包括点对点和发布/订阅）、可靠性、安全。AMQP协议更多用在企业系统内，对数据一致性、稳定性和可靠性要求很高的场景，对性能和吞吐量的要求还在其次。
- 在服务端处理同步发送的性能上，Kafka>RocketMQ>RabbitMQ。

### 事务

- AMQP 支持事务
- RocketMQ 事务实现原理


## 缓存中间件

### 常见产品

- Memcache：
  * libevent
  * 采用线程池模型，select 进程和工作进程通过管道模式通信？
  * 内存管理：预分配，利用 slab 机制做内存复用，减少碎片
- Redis
  * epoll
  * 把工作流程拆分成多个步骤，然后交给 epoll 异步完成，让一个线程尽量利用 CPU，即单线程模式
  * 内存管理：malloc？
  * 单机 10K TPS


### 缓存一致性（策略）

- Cache aside
- Read through
- Write through
- Write behind caching
- 缓存双写一致性保障方案？

### 淘汰策略

- FIFO
- LRU
- LFU

### 缓存常见问题

- 穿透
- 雪崩
- 击穿
